name: selenium build and test
on:
  push

jobs: 
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        
      - name: Setup NuGet to be used with Actions
        uses: NuGet/setup-nuget@v2.0

      - name: Setup MSBuild
        uses: microsoft/setup-msbuild@v2
        
      - name: Restore the NuGet packages
        run: nuget restore src/TestSolution/TestSolution.slnx
      
      - name: Build the solution
        run: msbuild src/TestSolution/TestSolution.slnx /p:Configuration=Release

      - name: Test what files are there
        shell: pwsh
        run: Get-ChildItem src/TestSolution -Recurse -Filter "*test*.dll"

      - name: Find test DLLs
        shell: pwsh
        run: |
          Get-ChildItem src\TestSolution -Recurse -File -Filter "*test*.dll" |
          Where-Object {
          $_.FullName -notmatch '\\obj\\' -and
          $_.Name -notlike '*TestAdapter.dll'
          } |
          ForEach-Object { $_.FullName }

      - name: Run the tests
        uses: microsoft/vstest-action@v1.0.0
        with:
          testAssembly: |
            **/*Test*.dll
            !**/*TestAdapter.dll
            !**/obj/**
          searchFolder: src/TestSolution
          
      #- name: Run the tests
      #  uses: microsoft/vstest-action@v1.0.0
      #  with:
      #    # Run tests from the specified files
      #    #testAssembly: # default is **\\*test*.dll\n!**\\*TestAdapter.dll\n!**\\obj\\**
      #    # Folder to search for the test assemblies
      #    searchFolder: src/TestSolution/


      #- name: Upload test results
      #  uses: actions/upload-artifact@v4
      #  with:
      #    name: test-results
      #    path: '**/*.trx'
    
